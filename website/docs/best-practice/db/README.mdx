---
sidebar_position: 1
description: 数据库

slug: /best-practice/db/
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# 数据库

[`nonebot-plugin-orm`](https://github.com/nonebot/plugin-orm) 是 NoneBot 的数据库支持插件。
本插件基于 [SQLAlchemy](https://www.sqlalchemy.org/) 和 [Alembic](https://alembic.sqlalchemy.org/)，提供了许多与 NoneBot 紧密集成的功能：

- 多 Engine / Connection 支持
- Session 管理
- 关系模型管理、依赖注入支持
- 数据库迁移

## 安装

<Tabs groupId="install">
<TabItem value="cli" label="使用 nb-cli">

```shell
nb plugin install nonebot-plugin-orm
```

</TabItem>
<TabItem value="pip" label="使用 pip">

```shell
pip install nonebot-plugin-orm
```

</TabItem>

<TabItem value="pdm" label="使用 pdm">

```shell
pdm add nonebot-plugin-orm
```

</TabItem>
</Tabs>

但是，只有插件本身是不够的，你还需要安装额外的依赖，参见 [数据库选择](#数据库选择)。

## 数据库后端

本插件只提供数据库连接能力，不提供数据库服务。你需要自行安装并配置一个数据库后端。
常见的数据库后端有：

### SQLite

[SQLite](https://www.sqlite.org/) 是一个轻量级的嵌入式数据库，它的数据以文件的形式存储在本地，不需要单独的数据库服务。
SQLite 非常适合用于开发环境和小型应用，但是不适合用于大型应用的生产环境。

虽然不需要单独的数据库服务，并且 [Python 标准库有对 SQLite 的内建支持](https://docs.python.org/zh-cn/3/library/sqlite3.html)，但你仍然需要安装额外的依赖：

<Tabs groupId="install">
<TabItem value="pip" label="使用 pip">

```shell
pip install nonebot-plugin-orm[sqlite]
```

</TabItem>

<TabItem value="pdm" label="使用 pdm">

```shell
pdm add nonebot-plugin-orm[sqlite]
```

</TabItem>
</Tabs>

默认情况下，数据库文件为 `<data path>/nonebot-plugin-orm/db.sqlite3`（数据目录由 [nonebot-plugin-localstore](/docs/next/best-practice/data-storing) 提供）。
或者，你可以通过配置 `SQLALCHEMY_DATABASE_URL` 来指定数据库文件路径：

```shell
SQLALCHEMY_DATABASE_URL=sqlite+aiosqlite:///file_path
```

### PostgreSQL

[PostgreSQL](https://www.postgresql.org/) 是世界上最先进的开源关系数据库，对各种高级且广泛应用的功能有最好的支持，是中小型应用的首选数据库。

<Tabs groupId="install">
<TabItem value="pip" label="使用 pip">

```shell
pip install nonebot-plugin-orm[postgresql]
```

</TabItem>

<TabItem value="pdm" label="使用 pdm">

```shell
pdm add nonebot-plugin-orm[postgresql]
```

</TabItem>
</Tabs>


```shell
SQLALCHEMY_DATABASE_URL=postgresql+psycopg://user:password@host:port/dbname[?key=value&key=value...]
```

### MySQL / MariaDB

[MySQL](https://www.mysql.com/) 和 [MariaDB](https://mariadb.com/) 是经典的开源关系数据库，适合用于中小型应用。

<Tabs groupId="install">
<TabItem value="pip" label="使用 pip">

```shell
pip install nonebot-plugin-orm[mysql]
```

</TabItem>

<TabItem value="pdm" label="使用 pdm">

```shell
pdm add nonebot-plugin-orm[mysql]
```

</TabItem>
</Tabs>

```shell
SQLALCHEMY_DATABASE_URL=mysql+aiomysql://user:password@host:port/dbname[?key=value&key=value...]
```
