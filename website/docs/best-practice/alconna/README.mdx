---
sidebar_position: 1
description: Alconna å‘½ä»¤è§£ææ‹“å±•

slug: /best-practice/alconna/
---

# Alconna æ’ä»¶

[`nonebot-plugin-alconna`](https://github.com/nonebot/plugin-alconna) æ˜¯ä¸€ç±»æä¾›äº†æ‹“å±•å“åº”è§„åˆ™çš„æ’ä»¶ã€‚
è¯¥æ’ä»¶ä½¿ç”¨ [Alconna](https://github.com/ArcletProject/Alconna) ä½œä¸ºå‘½ä»¤è§£æå™¨ï¼Œ
æ˜¯ä¸€ä¸ªç®€å•ã€çµæ´»ã€é«˜æ•ˆçš„å‘½ä»¤å‚æ•°è§£æå™¨, å¹¶ä¸”ä¸å±€é™äºè§£æå‘½ä»¤å¼å­—ç¬¦ä¸²ã€‚

è¯¥æ’ä»¶æä¾›äº†ä¸€ç±»æ–°çš„äº‹ä»¶å“åº”å™¨è¾…åŠ©å‡½æ•° `on_alconna`ï¼Œä»¥åŠ `AlconnaResult` ç­‰ä¾èµ–æ³¨å…¥å‡½æ•°ã€‚

è¯¥æ’ä»¶å£°æ˜äº†ä¸€ä¸ª `Matcher` çš„å­ç±» `AlconnaMatcher`ï¼Œå¹¶åœ¨ `AlconnaMatcher` ä¸­æ·»åŠ äº†ä¸€äº›æ–°çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š

- `assign`ï¼šåŸºäº `Alconna` è§£æç»“æœï¼Œæ‰§è¡Œæ»¡è¶³ç›®æ ‡è·¯å¾„çš„å¤„ç†å‡½æ•°
- `dispatch`ï¼šç±»ä¼¼ `CommandGroup`ï¼Œå¯¹ç›®æ ‡è·¯å¾„åˆ›å»ºä¸€ä¸ªæ–°çš„ `AlconnaMatcher`ï¼Œå¹¶å°†è§£æç»“æœåˆ†é…ç»™è¯¥ `AlconnaMatcher`
- `got_path`ï¼šç±»ä¼¼ `got`ï¼Œä½†æ˜¯å¯ä»¥æŒ‡å®šç›®æ ‡è·¯å¾„ï¼Œå¹¶ä¸”èƒ½å¤ŸéªŒè¯è§£æç»“æœæ˜¯å¦å¯ç”¨
- ...

åŸºäº `Alconna` çš„ç‰¹æ€§ï¼Œè¯¥æ’ä»¶åŒæ—¶æä¾›äº†ä¸€ç³»åˆ—ä¾¿æ·çš„æ¶ˆæ¯æ®µæ ‡æ³¨ã€‚
æ ‡æ³¨å¯ç”¨äºåœ¨ `Alconna` ä¸­åŒ¹é…æ¶ˆæ¯ä¸­é™¤ text å¤–çš„å…¶ä»–æ¶ˆæ¯æ®µï¼Œä¹Ÿå¯ç”¨äºå¿«é€Ÿåˆ›å»ºå„é€‚é…å™¨ä¸‹çš„æ¶ˆæ¯æ®µã€‚æ‰€æœ‰æ ‡æ³¨ä½äº `nonebot_plugin_alconna.adapters` ä¸­ã€‚

è¯¥æ’ä»¶åŒæ—¶é€šè¿‡æä¾› `UniMessage` (é€šç”¨æ¶ˆæ¯æ¨¡å‹) å®ç°äº†**è·¨å¹³å°æ¥æ”¶å’Œå‘é€æ¶ˆæ¯**çš„åŠŸèƒ½ã€‚

## å®‰è£…æ’ä»¶

åœ¨ä½¿ç”¨å‰è¯·å…ˆå®‰è£… `nonebot-plugin-alconna` æ’ä»¶è‡³é¡¹ç›®ç¯å¢ƒä¸­ï¼Œå¯å‚è€ƒ[è·å–å•†åº—æ’ä»¶](../../tutorial/store.mdx#å®‰è£…æ’ä»¶)æ¥äº†è§£å¹¶é€‰æ‹©å®‰è£…æ’ä»¶çš„æ–¹å¼ã€‚å¦‚ï¼š

åœ¨**é¡¹ç›®ç›®å½•**ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```shell
nb plugin install nonebot-plugin-alconna
```

æˆ–

```shell
pip install nonebot-plugin-alconna
```

## å¯¼å…¥æ’ä»¶

ç”±äº `nonebot-plugin-alconna` ä½œä¸ºæ’ä»¶ï¼Œå› æ­¤éœ€è¦åœ¨ä½¿ç”¨å‰å¯¹å…¶è¿›è¡Œ**åŠ è½½**å¹¶**å¯¼å…¥**å…¶ä¸­çš„ `on_alconna` æ¥ä½¿ç”¨å‘½ä»¤æ‹“å±•ã€‚ä½¿ç”¨ `require` æ–¹æ³•å¯è½»æ¾å®Œæˆè¿™ä¸€è¿‡ç¨‹ï¼Œå¯å‚è€ƒ [è·¨æ’ä»¶è®¿é—®](../../advanced/requiring.md) ä¸€èŠ‚è¿›è¡Œäº†è§£ã€‚

```python
from nonebot import require

require("nonebot_plugin_alconna")

from nonebot_plugin_alconna import on_alconna
```

## ä½¿ç”¨æ’ä»¶

åœ¨å‰é¢çš„[æ·±å…¥æŒ‡å—](../../appendices/session-control.mdx)ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¾—åˆ°äº†ä¸€ä¸ªå¤©æ°”æ’ä»¶ã€‚
ç°åœ¨æˆ‘ä»¬å°†ä½¿ç”¨ `Alconna` æ¥æ”¹å†™è¿™ä¸ªæ’ä»¶ã€‚

<details>
  <summary>æ’ä»¶ç¤ºä¾‹</summary>

```python title=weather/__init__.py
from nonebot import on_command
from nonebot.rule import to_me
from nonebot.matcher import Matcher
from nonebot.adapters import Message
from nonebot.params import CommandArg, ArgPlainText

weather = on_command("å¤©æ°”", rule=to_me(), aliases={"weather", "å¤©æ°”é¢„æŠ¥"})

@weather.handle()
async def handle_function(matcher: Matcher, args: Message = CommandArg()):
    if args.extract_plain_text():
        matcher.set_arg("location", args)

@weather.got("location", prompt="è¯·è¾“å…¥åœ°å")
async def got_location(location: str = ArgPlainText()):
    if location not in ["åŒ—äº¬", "ä¸Šæµ·", "å¹¿å·", "æ·±åœ³"]:
        await weather.reject(f"ä½ æƒ³æŸ¥è¯¢çš„åŸå¸‚ {location} æš‚ä¸æ”¯æŒï¼Œè¯·é‡æ–°è¾“å…¥ï¼")
    await weather.finish(f"ä»Šå¤©{location}çš„å¤©æ°”æ˜¯...")
```

</details>

```python {5-10,14-16,18-19}
from nonebot.rule import to_me
from arclet.alconna import Alconna, Args
from nonebot_plugin_alconna import Match, AlconnaMatcher, on_alconna

weather = on_alconna(
    Alconna("å¤©æ°”", Args["location?", str]),
    rule=to_me(),
)
weather.shortcut("weather", {"command": "å¤©æ°”"})
weather.shortcut("å¤©æ°”é¢„æŠ¥", {"command": "å¤©æ°”"})


@weather.handle()
async def handle_function(matcher: AlconnaMatcher, location: Match[str]):
    if location.available:
        matcher.set_path_arg("location", location.result)

@weather.got_path("location", prompt="è¯·è¾“å…¥åœ°å")
async def got_location(location: str):
    if location not in ["åŒ—äº¬", "ä¸Šæµ·", "å¹¿å·", "æ·±åœ³"]:
        await weather.reject(f"ä½ æƒ³æŸ¥è¯¢çš„åŸå¸‚ {location} æš‚ä¸æ”¯æŒï¼Œè¯·é‡æ–°è¾“å…¥ï¼")
    await weather.finish(f"ä»Šå¤©{location}çš„å¤©æ°”æ˜¯...")
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `Alconna` æ¥è§£æå‘½ä»¤ï¼Œ`on_alconna` ç”¨æ¥åˆ›å»ºå“åº”å™¨ï¼Œä½¿ç”¨ `Match` æ¥è·å–è§£æç»“æœã€‚

å…³äºæ›´å¤š `Alconna` çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¯å‚è€ƒ [Alconna æ–‡æ¡£](https://arclet.top/docs/tutorial/alconna)ï¼Œ
æˆ–é˜…è¯» [Alconna åŸºæœ¬ä»‹ç»](./command.md) ä¸€èŠ‚ã€‚

å…³äºæ›´å¤š `on_alconna` çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¯å‚è€ƒ [æ’ä»¶æ–‡æ¡£](https://github.com/nonebot/plugin-alconna/blob/master/docs.md)ï¼Œ
æˆ–é˜…è¯» [å“åº”è§„åˆ™çš„ä½¿ç”¨](./matcher.md) ä¸€èŠ‚ã€‚

## äº¤æµä¸åé¦ˆ

QQ äº¤æµç¾¤: [ğŸ”— é“¾æ¥](https://jq.qq.com/?_wv=1027&k=PUPOnCSH)

å‹é“¾: [ğŸ“š æ–‡æ¡£](https://graiax.cn/guide/message_parser/alconna.html)
