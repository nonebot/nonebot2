import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Alconna æ’ä»¶

[`nonebot-plugin-alconna`](https://github.com/nonebot/plugin-alconna) æ˜¯ä¸€ç±»æå¤§åœ°æå‡äº† NoneBot å¼€å‘ä½“éªŒçš„æ’ä»¶ã€‚

è¯¥æ’ä»¶å¯åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š

- å¢å¼ºçš„å‘½ä»¤è§£æ: åŸºäº [Alconna](https://github.com/ArcletProject/Alconna), æä¾›ä¸€ç±»æ–°çš„äº‹ä»¶å“åº”å™¨è¾…åŠ©å‡½æ•° `on_alconna`. ç›¸æ¯” `on_command`, `on_shell`, `on_regex` ç­‰å‡½æ•°ï¼Œ`on_alconna` æä¾›äº†æ›´å¼ºå¤§çš„å‘½ä»¤è§£æèƒ½åŠ›ä¸è¯¸å¤šç‰¹æ€§ã€‚
- é€šç”¨æ¶ˆæ¯ç»„ä»¶: å®ç°äº†è·¨å¹³å°æ¥æ”¶ã€å‘é€ã€æ’¤å›ã€ç¼–è¾‘ã€è¡¨æ€æ¶ˆæ¯çš„åŠŸèƒ½ã€‚
  - `UniMessage` é€šç”¨æ¶ˆæ¯æ¨¡å‹ï¼Œæ”¯æŒå„é€‚é…å™¨ä¸‹çš„æ¶ˆæ¯è½¬æ¢å’Œå¯¼å‡ºï¼Œå‘é€ã€‚
  - `Text`, `Image`, `At` ç­‰é€šç”¨æ¶ˆæ¯æ®µæ¨¡å‹ï¼Œæ—¢ä¸ `UniMessage` é…åˆä½¿ç”¨ï¼Œåˆèƒ½ç”¨äº `Alconna` çš„å‘½ä»¤è§£æã€‚
  - `message_recall`, `message_edit`, `message_reaction` ç­‰åŠŸèƒ½å‡½æ•°ã€‚
  - `Target` é€šç”¨æ¶ˆæ¯ç›®æ ‡æ¨¡å‹ï¼Œå¹¶é€šè¿‡è¯¥æ¨¡å‹è¿›è¡Œä¸»åŠ¨æ¶ˆæ¯å‘é€ã€‚
  - `UniMsg`, `MsgId`, `MsgTarget`, `at_in`, `at_me` ç­‰æä¾›ç»™ nonebot ä½¿ç”¨çš„ä¾èµ–æ³¨å…¥å’Œ `Rule`ã€‚
- å†…ç½®åŠŸèƒ½æ’ä»¶ï¼šåŸºäºä¸Šè¿°éƒ¨åˆ†å®ç°çš„å†…ç½®åŠŸèƒ½æ’ä»¶ã€‚
  - `echo`: é€šè¿‡ `on_alconna` å®ç°çš„ echo æ’ä»¶ï¼Œæ”¯æŒå›æ˜¾å›å¤æ¶ˆæ¯ã€‚
  - `help`: åˆ—å‡ºæ‰€æœ‰ `on_alconna` äº‹ä»¶å“åº”å™¨çš„å¸®åŠ©ä¿¡æ¯æˆ–å…¶å¯¹åº”çš„æ’ä»¶ä¿¡æ¯ã€‚
  - `lang`: åˆ‡æ¢ `Alconna` ä½¿ç”¨çš„è¯­è¨€
  - `switch`: ç¦ç”¨/å¯ç”¨æŸä¸ªæŒ‡ä»¤
  - `with`: é’ˆå¯¹å…·æœ‰å¤šä¸ªå­å‘½ä»¤çš„æŒ‡ä»¤ï¼Œé€šè¿‡ `with` åœ¨å½“å‰ä¼šè¯ä¸­è½½å…¥å‘½ä»¤å¤´ä»¥èŠ‚çœè¾“å…¥ã€‚

ä»¥æœ€æ–°ç‰ˆæœ¬ä¸ºä¾‹ (v0.59), æœ¬æ’ä»¶å·²æ”¯æŒ NoneBot ç”Ÿæ€ä¸­å‡ ä¹æ‰€æœ‰çš„é€‚é…å™¨, åŒ…æ‹¬:

| åè®®åç§°                                                            | è·¯å¾„                                 |
| ------------------------------------------------------------------- | ------------------------------------ |
| [OneBot åè®®](https://onebot.dev/)                                  | adapters.onebot11, adapters.onebot12 |
| [Telegram](https://core.telegram.org/bots/api)                      | adapters.telegram                    |
| [é£ä¹¦](https://open.feishu.cn/document/home/index)                  | adapters.feishu                      |
| [GitHub](https://docs.github.com/en/developers/apps)                | adapters.github                      |
| [QQ bot](https://github.com/nonebot/adapter-qq)                     | adapters.qq                          |
| [é’‰é’‰](https://open.dingtalk.com/document/)                         | adapters.ding                        |
| [Console](https://github.com/nonebot/adapter-console)               | adapters.console                     |
| [å¼€é»‘å•¦](https://developer.kookapp.cn/)                             | adapters.kook                        |
| [Mirai](https://docs.mirai.mamoe.net/mirai-api-http/)               | adapters.mirai                       |
| [Ntchat](https://github.com/JustUndertaker/adapter-ntchat)          | adapters.ntchat                      |
| [MineCraft](https://github.com/17TheWord/nonebot-adapter-minecraft) | adapters.minecraft                   |
| [Walle-Q](https://github.com/onebot-walle/nonebot_adapter_walleq)   | adapters.onebot12                    |
| [Discord](https://github.com/nonebot/adapter-discord)               | adapters.discord                     |
| [Red åè®®](https://github.com/nonebot/adapter-red)                  | adapters.red                         |
| [Satori](https://github.com/nonebot/adapter-satori)                 | adapters.satori                      |
| [Dodo IM](https://github.com/nonebot/adapter-dodo)                  | adapters.dodo                        |
| [Kritor](https://github.com/nonebot/adapter-kritor)                 | adapters.kritor                      |
| [Tailchat](https://github.com/eya46/nonebot-adapter-tailchat)       | adapters.tailchat                    |
| [Mail](https://github.com/mobyw/nonebot-adapter-mail)               | adapters.mail                        |
| [å¾®ä¿¡å…¬ä¼—å·](https://github.com/YangRucheng/nonebot-adapter-wxmp)   | adapters.wxmp                        |
| [é»‘ç›’è¯­éŸ³](https://github.com/lclbm/adapter-heybox)                 | adapters.heybox                      |
| [Milky](https://github.com/nonebot/adapter-milky)                   | adapters.milky                       |
| [EFChat](https://github.com/molanp/nonebot_adapter_efchat)          | adapters.efchat                      |

## å®‰è£…æ’ä»¶

åœ¨ä½¿ç”¨å‰è¯·å…ˆå®‰è£… `nonebot-plugin-alconna` æ’ä»¶è‡³é¡¹ç›®ç¯å¢ƒä¸­ï¼Œå¯å‚è€ƒ[è·å–å•†åº—æ’ä»¶](../../tutorial/store.mdx#å®‰è£…æ’ä»¶)æ¥äº†è§£å¹¶é€‰æ‹©å®‰è£…æ’ä»¶çš„æ–¹å¼ã€‚å¦‚ï¼š

åœ¨**é¡¹ç›®ç›®å½•**ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

<Tabs groupId="install">
<TabItem value="cli" label="ä½¿ç”¨ nb-cli">

```shell
nb plugin install nonebot-plugin-alconna
```

</TabItem>
<TabItem value="pip" label="ä½¿ç”¨ pip">

```shell
pip install nonebot-plugin-alconna
```

</TabItem>

<TabItem value="pdm" label="ä½¿ç”¨ pdm">

```shell
pdm add nonebot-plugin-alconna
```

</TabItem>
</Tabs>

## å¯¼å…¥æ’ä»¶

ç”±äº `nonebot-plugin-alconna` ä½œä¸ºæ’ä»¶ï¼Œå› æ­¤éœ€è¦åœ¨ä½¿ç”¨å‰å¯¹å…¶è¿›è¡Œ**åŠ è½½**ã€‚ä½¿ç”¨ `require` æ–¹æ³•å¯è½»æ¾å®Œæˆè¿™ä¸€è¿‡ç¨‹ï¼Œå¯å‚è€ƒ [è·¨æ’ä»¶è®¿é—®](../../advanced/requiring.md) ä¸€èŠ‚è¿›è¡Œäº†è§£ã€‚

```python
from nonebot import require

require("nonebot_plugin_alconna")

from nonebot_plugin_alconna import ...
```

## ä½¿ç”¨æ’ä»¶

åœ¨å‰é¢çš„[æ·±å…¥æŒ‡å—](../../appendices/session-control.mdx)ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¾—åˆ°äº†ä¸€ä¸ªå¤©æ°”æ’ä»¶ã€‚
ç°åœ¨æˆ‘ä»¬å°†ä½¿ç”¨ `Alconna` æ¥æ”¹å†™è¿™ä¸ªæ’ä»¶ã€‚

<details>
  <summary>æ’ä»¶ç¤ºä¾‹</summary>

```python title=weather/__init__.py
from nonebot import on_command
from nonebot.rule import to_me
from nonebot.matcher import Matcher
from nonebot.adapters import Message
from nonebot.params import CommandArg, ArgPlainText

weather = on_command("å¤©æ°”", rule=to_me(), aliases={"weather", "å¤©æ°”é¢„æŠ¥"})

@weather.handle()
async def handle_function(matcher: Matcher, args: Message = CommandArg()):
    if args.extract_plain_text():
        matcher.set_arg("location", args)

@weather.got("location", prompt="è¯·è¾“å…¥åœ°å")
async def got_location(location: str = ArgPlainText()):
    if location not in ["åŒ—äº¬", "ä¸Šæµ·", "å¹¿å·", "æ·±åœ³"]:
        await weather.reject(f"ä½ æƒ³æŸ¥è¯¢çš„åŸå¸‚ {location} æš‚ä¸æ”¯æŒï¼Œè¯·é‡æ–°è¾“å…¥ï¼")
    await weather.finish(f"ä»Šå¤©{location}çš„å¤©æ°”æ˜¯...")
```

</details>

```python {5-9,13-15,17-18}
from nonebot.rule import to_me
from arclet.alconna import Alconna, Args
from nonebot_plugin_alconna import Match, on_alconna

weather = on_alconna(
    Alconna("å¤©æ°”", Args["location?", str]),
    aliases={"weather", "å¤©æ°”é¢„æŠ¥"},
    rule=to_me(),
)


@weather.handle()
async def handle_function(location: Match[str]):
    if location.available:
        weather.set_path_arg("location", location.result)

@weather.got_path("location", prompt="è¯·è¾“å…¥åœ°å")
async def got_location(location: str):
    if location not in ["åŒ—äº¬", "ä¸Šæµ·", "å¹¿å·", "æ·±åœ³"]:
        await weather.reject(f"ä½ æƒ³æŸ¥è¯¢çš„åŸå¸‚ {location} æš‚ä¸æ”¯æŒï¼Œè¯·é‡æ–°è¾“å…¥ï¼")
    await weather.finish(f"ä»Šå¤©{location}çš„å¤©æ°”æ˜¯...")
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `Alconna` æ¥è§£æå‘½ä»¤ï¼Œ`on_alconna` ç”¨æ¥åˆ›å»ºå“åº”å™¨ï¼Œä½¿ç”¨ `Match` æ¥è·å–è§£æç»“æœã€‚

å…³äºæ›´å¤š `Alconna` çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¯å‚è€ƒ [Alconna æ–‡æ¡£](https://arclet.top/tutorial/alconna)ï¼Œ
æˆ–é˜…è¯» [Alconna åŸºæœ¬ä»‹ç»](./command.md) ä¸€èŠ‚ã€‚

å…³äºæ›´å¤š `on_alconna` çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¯å‚è€ƒ [æ’ä»¶æ–‡æ¡£](https://github.com/nonebot/plugin-alconna/blob/master/docs.md)ï¼Œ
æˆ–é˜…è¯» [å“åº”è§„åˆ™çš„ä½¿ç”¨](./matcher.mdx) ä¸€èŠ‚ã€‚

## äº¤æµä¸åé¦ˆ

QQ äº¤æµç¾¤: [ğŸ”— é“¾æ¥](https://jq.qq.com/?_wv=1027&k=PUPOnCSH)

å‹é“¾: [ğŸ“š æ–‡æ¡£](https://graiax.cn/guide/message_parser/alconna.html)
